name: Block forbidden staging folders

on:
  pull_request:
    branches: [ main ]

jobs:
  block-stg-folders:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Detect forbidden paths
        run: |
          forbidden_paths="static/admin api lib"
          changed_files=$(git diff --name-only origin/main...HEAD)

          for path in $forbidden_paths; do
            if echo "$changed_files" | grep -q "^$path/"; then
              echo "ERROR: Cannot merge '$path' into main."
              exit 1
            fi
          done